name: Code Quality Analysis

on:
  schedule:
    - cron: '0 9 * * MON'  # Every Monday at 9 AM
  workflow_dispatch:  # Manual trigger

permissions:
  contents: read
  issues: write
  pull-requests: read

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
      
      - name: Analyze Code Quality
        run: |
          echo "Java Code Quality Analysis"
          find src -name "*.java" | wc -l
          echo "Java files found in src directory"
      
      - name: Build with Gradle
        run: ./gradlew build --continue || true
      
      - name: Create Analysis Issue
        uses: actions/github-script@v7
        with:
          script: |
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `[AI Code Quality] Analysis - ${new Date().toLocaleDateString()}`,
              labels: ['analysis', 'automated', 'code-quality'],
              body: `## Code Quality Analysis Report\n\n### Summary\nAutomated analysis of Java-db-challenge codebase\n\n### Status\nâœ… Workflow executed successfully\n\n### Next Steps\n- Review code structure\n- Check test coverage\n- Optimize database queries\n\n*Generated by GitHub Actions*`
            });
